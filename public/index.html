<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<title>Somu's Family</title>
<link rel="shortcut icon" href="images/family.ico" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<link rel="stylesheet" href="style.css" type="text/css" charset="utf-8" />
<style>
	#divchat {
       bottom: 10px;
       right: 0;
       position: fixed;
       z-index: 1000;
  }
	#divdesignedby {
       bottom: 0;
       right: 0;
       position: fixed;
       z-index: 1000;
  }
  #divphotos {
      bottom: 350px;
      right: 0;
      position: fixed;
      z-index: 1000;
      overflow-y: scroll;
      max-height: 50%;
  }
  #divtextbox {
      bottom: 10px;
      right: 0;
      position: fixed;
      z-index: 1000;
    }
  /* Chat containers */
  .container {
      border: 2px solid #dedede;
      background-color: #f1f1f1;
      border-radius: 5px;
      max-width: 379px;
      padding-left : 5px;
      padding-right: 5px;
      padding-top: 1px;
      padding-bottom: 1px;
      margin: 1px 0;
  }

  /* Darker chat container */
  .darker {
      border-color: #ccc;
      background-color: #ddd;
  }

  /* Clear floats */
  .container::after {
      content: "";
      clear: both;
      display: table;
  }

  /* Style images */
  .container img {
      float: left;
      max-width: 60px;
      width: 100%;
      margin-right: 20px;
      border-radius: 50%;
  }

  /* Style the right image */
  .container img.right {
      float: right;
      margin-left: 20px;
      margin-right:0;
  }

  /* Style time text */
  .time-right {
      float: right;
      color: #aaa;
      font-size: 8pt;
  }

  /* Style time text */
  .time-left {
      float: left;
      color: #999;
      font-size: 8pt;
  }

  /* Style msg text */
  .msg-right {
      float: right;
      padding-left: 25px;
      padding-bottom: 5px;
  }

  /* Style msg text */
  .msg-left {
      float: left;
      padding-right: 25px;
      padding-bottom: 5px;
  }

  /* Style chat window */
  .chat-window {
      overflow-y: scroll;
      max-height: 50%;
  }
</style>
</head>
<body>
    <script src="https://www.gstatic.com/firebasejs/5.5.1/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
        apiKey: "AIzaSyAUGgozJYcjWp-SX4QTRKnqSpiULHxZie8",
        authDomain: "somu-website.firebaseapp.com",
        databaseURL: "https://somu-website.firebaseio.com",
        projectId: "somu-website",
        storageBucket: "somu-website.appspot.com",
        messagingSenderId: "176778291160"
      };
      firebase.initializeApp(config);
    </script>
    <script>
      /*
      var xhttp = new XMLHttpRequest();
      xhttp.onreadystatechange = function() {
        alert('readystate:' + this.readyState + '; status:' + this.status + '; statusText:' + this.statusText + '; responseText:' + this.responseText);
          if (this.readyState === 4 && this.status === 200) {
              //document.getElementById("demo").innerHTML = this.responseText;
              alert(this.responseText);
          }
        };
      */

      function doit_onkeypress(e){
        try{
          if (e.keyCode == 13) {  //checks whether the pressed key is "Enter"
          sendMsgToBot('booming-cosine-188305','1234567890', e.target.value,'en-US');
          let parentDiv = document.getElementById('divchat');
            //if(validated==="0"){
              //if(!ans1){
                //dk = validateFirstAnswer(normaliseString(e.target.value));
                //if(dk==="d" || dk==="k"){
                  //document.title = dk;
                  //ans1 = true;
                  //let textDiv = document.getElementById('divtextbox');
                  parentDiv.innerHTML="";

                  let div = document.createElement('div');
                  div.className = "container";
                  div.innerHTML = "<span class='msg-right'>" + e.target.value + "</span>";
                  parentDiv.appendChild(div);

                  /*
                  div = document.createElement('div');
                  div.className = "container darker";
                  div.innerHTML = "<span class='msg-left'>" + "is it ?" + "</span>";
                  parentDiv.appendChild(div);
                  */

                  //parentDiv.appendChild(textDiv);
                  //document.getElementById("msg").focus();
                  parentDiv.scrollTop = parentDiv.scrollHeight;

                  /*
                  let ta = document.createElement('textarea');
                  ta.id = "msg";
                  ta.rows="3";
                  ta.cols = "53";
                  ta.placeholder = "type here...";
                  ta.setAttribute("onkeypress", "Javascript:doit_onkeypress(event)");
                  ta.autofocus = true;

                  parentDiv.appendChild(ta);
                  document.getElementById("msg").text = "";
                  document.getElementById("msg").focus();
                  */

                //}else{
                //  sendMsg(e.target.value);
                //}
              //}else{
              //  if(validateSecondAnswer(e.target.value)){
              //    validated = "1";
              //    validateMessages();
              //    retrieveMessages();
              //  }else{
              //    ans1 = false;
              //    sendMsg(e.target.value);
              //  }
              //}
            //}else{
            //  sendMsg(e.target.value);
            //}
            e.target.value = "";
            e.preventDefault();
          }
        }catch(err){
          alert(err);
        }
      }

      function sendMsgToBot(strProjectID, strSessionID, strQuery, strLangCode){
        try{
          var cloudFunctionToSendMsgToBot = firebase.functions().httpsCallable('sendMsgToBot');
          //alert(1);
          cloudFunctionToSendMsgToBot(
            {
              projectId: strProjectID, 
              sessionId: strSessionID, 
              queries: strQuery, 
              languageCode: strLangCode
            }).then(function(result) {
            // Read result of the Cloud Function.
            alert(JSON.stringify(result));
            alert(result.data.fulfillmentText);
          }).catch(function(cloudFuncErr){
            alert(cloudFuncErr);
          });
        }catch(err){
          alert(err);
        }
        
        //xhttp.open("POST", "https://us-central1-booming-cosine-188305.cloudfunctions.net/sendMessageToBot", true);
        //xhttp.open("POST", "https://us-central1-somu-website.cloudfunctions.net/addMessage", true);
        //xhttp.open("POST", "tmp.html", true);
        //xhttp.setRequestHeader("Content-Type", "application/json");
        //xhttp.setRequestHeader("my-header", "my header value");
        //xhttp.withCredentials = true;
        //xhttp.send();
         
      }
    </script>
    
    <script>
      var photosRef =  firebase.database().ref("mydb/tmp");
      photosRef.orderByKey().on("value", function(snapshot) {
        if(snapshot!=null){
          var strPhotos = snapshot.val();
          var strImages = '';
          let photosDiv = document.getElementById('divphotos');
          photosDiv.innerHTML="";
          var strPhoto = strPhotos.split(",");
          for (var i = 0; i < strPhoto.length; i++){
            if(strPhoto[i].trim()!==''){
              strImages = strImages + "<img width='50' height='50' src='https://www.somu.co.in/images/photos/" + strPhoto[i] + ".jpg'/><br>";
            }
          }
          photosDiv.innerHTML = strImages;
        }
      });
    </script>

<div id="wrapper">
  <h1>Our Family</h1>
  <div id="family"></div>
  <div id="head-top"></div>
  <div id="head-right"></div>
  <div id="nav">
    <ul>
      <li><a href="#">Home</a></li>
      <li><a href="#">About us</a></li>
      <li><a href="#">Photo gallery</a></li>
      <li><a href="#">Contact us</a></li>
    </ul>
    <div id="nav-bot"></div>
  </div>
  <div id="body">
    <div class="i">
      <h2 class="shallow"><strong>Welcome</strong> to our family</h2>
      <p>we are Somu family.  We are 5 in number.  A happy family.</p>
      <p>We have mixture of talent like doctor, engineer, designers, students, dancers, martial arts etc. etc..</p>
      <p class="more"><a href="#">more...</a></p>
      <h2 class="shallow"><strong>Family</strong> photo gallery</h2>
      <p><img src="images/gallery.jpg" width="233" height="161" alt="Gallery" class="left" /></p>
      <div id="view">
        <p class="dark"><a href="#">VIEW OUR</a></p>
        <p class="orange"><a href="#">PHOTO<br />
          GALLERY</a></p>
      </div>
      <div class="clear"></div>
      <h2><strong>Family</strong> functions</h2>
      <ul class="orange-bullet">
        <li>House warming ceremony</li>
        <li>Elder daughter's toddling function</li>
      </ul>
      <h2 class="orange"><strong>Family</strong> fun &amp; travel</h2>
      <div id="funtravel"> <img src="images/pic_1.jpg" width="95" height="116" alt="Pic 1" class="left" />
        <div id="collect">
          <p class="dark">COLLECT OUR</p>
          <p class="orange">FUN &amp; TRAVELBOOK</p>
          <p class="other">Travelogue</p>
        </div>
      </div>
      <div id="wrapper">
          <div id="body">
            <div id="divchat" class="chat-window">
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
                abcdefgh
            </div>
            <div id="divtextbox">
                <textarea id="msg" rows="3" cols="55" autofocus placeholder="type here..." onkeypress="Javascript:doit_onkeypress(event)"></textarea>
            </div>
          </div>
        <!----
          <div id="divchat">
            <input type="text" id="text_msg" name="text_msg">
            <input type="button" id="send_msg" name="send_msg" value="send" onclick="sendMsgToBot('booming-cosine-188305','1234567890', text_msg.value,'en-US')">
        -->
        <div id="divdesignedby">designed by <a href="mailto:krishnasomu@yahoo.com">krishna somu</a></div>
        <!--
        <iframe width="280" height="330" src="https://console.dialogflow.com/api-client/demo/embedded/d6eee622-edf2-404b-aa8d-ef0316d6af22"></iframe>
        -->
        <div id="divphotos">
         <!--<img src="https://www.somu.co.in/images/photos/1.jpg">-->
        </div>
		</div>
      </div>
    </div>
  </div>
</div>
</body>
</html>
